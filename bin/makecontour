#!/bin/sh

if [ -z "$1" ]; then
	echo "USAGE: $0 <input file>"
	exit
fi

if [ ! -e "$1" ]; then
	echo "ERROR: cannot open file $1"
	exit
fi
if [ ! -f "$1" ]; then
	echo "ERROR: cannot open file $1"
	exit
fi

fn=${1%.*}

r1=`minmax -C $1 | gawk '{print $1}'`
r2=`minmax -C $1 | gawk '{print $2}'`
r3=`minmax -C $1 | gawk '{print $3}'`
r4=`minmax -C $1 | gawk '{print $4}'`
range="$r1/$r2/$r3/$r4"

cat $1 | gawk '{print $1,$2,$4}' | surface -Gtmp.grd -I0.1/0.1 -R$range
makecpt -T-8/8/2 -Z >| mg.cpt
grdimage tmp.grd -JX12 -R -P -Cmg.cpt -P -B2f10nSWe -K >| "$fn".eps
grdcontour tmp.grd -JX -R -C0.5 -A1f10a0 -L-100/-0.5 -Wta -K -O >> "$fn".eps
grdcontour tmp.grd -JX -R -C0.5 -A1f10a0 -L0/100 -K -O >> "$fn".eps
psscale -Cmg.cpt -D6/-1.2/5/0.5h -B4::/:"(nT)": -O >> "$fn".eps

rm -f mg.cpt
rm -f tmp.grd

evince "$fn".eps &

